<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF Starter</title>
    <link rel="stylesheet" href="https://duojia.github.io/LIFF/style.css">
</head>

<body>
    <div class="input">
        <label id="Q1" for= "Q1">Q1</label>
        <input name = 'Q1' type="text" placeholder="your answer">
    </br>
        <label id="Q2" for= "Q2">Q2</label>
        <input name = 'Q2' type="text" placeholder="your answer">
    </br>
        <label id="Q3" for= "Q3">Q3</label>
        <input name = 'Q3' type="text" placeholder="your answer">
    </br>
        <label id="Q4" for= "Q4">Q4</label>
        <input name = 'Q4' type="text" placeholder="your answer">
    </br>
        <label id="Q5" for= "Q5">Q5</label>
        <input name = 'Q5' type="text" placeholder="your answer">
    </br>
        <label id="Q6" for= "Q6">Q6</label>
        <input name = 'Q6' type="text" placeholder="your answer">
    </br>
        <label id="Q7" for= "Q7">Q7</label>
        <input name = 'Q7' type="text" placeholder="your answer">
    </br>
        <label id="Q8" for= "Q8">Q8</label>
        <input name = 'Q8' type="text" placeholder="your answer">
    </br>
        <label id="Q9" for= "Q9">Q9</label>
        <input name = 'Q9' type="text" placeholder="your answer">
    </br>
        <label id="Q10" for= "Q10">Q10</label>
        <input name = 'Q10' type="text" placeholder="your answer">
    </br>
        <button id="sendmessagebutton">送出答案</button>
        <button id="closewindowbutton">Close Window</button>
    </div>

    <!-- Javascript 使用Papaparese 讀取QA csv -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>`
    <script src="https://cdn.staticfile.org/PapaParse/5.1.0/papaparse.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>

    <script language="javascript">

   
    

    var spData = null;
    function doData(json) {
        spData = json.feed.entry; //取回來的資料都會在 feed.entry 裡面
    }
    
    function readData(parent) {
      var data = spData;
      var rowData = [];
      var row = 0;
      var question = new Array();
      var answer = new Array();

      for(var r=0; r<data.length; r++) {
          var cell = data[r]["gs$cell"];//可以透過 gs$cell 來找到所屬的欄/列
          var val = cell["$t"];
        //   console.log("text:"+text)
        //   console.log("cell[1]:"+cell_.gs$cell.row)

           if (cell.col == 1) {
                rowData = [];
                row++;
           }
           rowData.push(val);
           question[r]=rowData[0];
           answer[r]=rowData[1];
          //console.log("answer:"+answer)
          //console.log("question:"+question)

      }
      $('#Q1').html(question[2]);
      $('#Q2').html(question[4]);
      $('#Q3').html(question[6]);
      $('#Q4').html(question[8]);
      $('#Q5').html(question[10]);
      $('#Q6').html(question[12]);
      $('#Q7').html(question[14]);
      $('#Q8').html(question[16]);
      $('#Q9').html(question[18]);
      $('#Q10').html(question[20]);

      console.log("rowData:"+rowData[0])
      console.log("answer:"+answer)
      console.log("question:"+question)
  }

    
    //頁面載入時執行
    $(document).ready(function() {
        //要執行的JQuery
        readData($("#data"));
        

        //PAPA Parse版本，但中文會亂碼，故改採Google sheet 方式
        // Papa.parse("https://duojia.github.io/LIFF/QA/QA1.csv", {
        //     header: true,
        //     encoding: "UTF-8",
        //     download: true,
        //     complete: function(results) {
        //         console.log(results.data[0].ans)
        //         for(var i =0;i<results.data.length;i++){
        //             question[i] = results.data[i].question
        //             answer[i] = results.data[i].ans
        //         }
        //         //修改Label值，用ID抓，來改變text值
        //         $('#Q1').html(question[0]);
        //         $('#Q2').html(question[1]);
        //         $('#Q3').html(question[2]);
        //         $('#Q4').html(question[3]);
        //         $('#Q5').html(question[4]);
        //         $('#Q6').html(question[5]);
        //         $('#Q7').html(question[6]);
        //         $('#Q8').html(question[7]);
        //         $('#Q9').html(question[8]);
        //         $('#Q10').html(question[9]);
        //     }
        // });
    });
    
    //檢查驗證答案
    document.getElementById('sendmessagebutton').addEventListener('click', function() {
        if (!liff.isInClient()) {
            sendAlertIfNotInClient();
        } else {
            liff.sendMessages([{
                'type': 'text',
                'text': "You've successfully sent a message! Hooray!"
            }]).then(function() {
                window.alert('Message sent');
            }).catch(function(error) {
                window.alert('Error sending message: ' + error);
            });
        }
    });
    // closeWindow call
    document.getElementById('closewindowbutton').addEventListener('click', function() {
        if (!liff.isInClient()) {
            sendAlertIfNotInClient();
        } else {
            liff.closeWindow();
        }
    });
    </script>

    <script src="https://spreadsheets.google.com/feeds/cells/1sgZcl7U4iiVYCg_oOr4kYvXoyB4_NBSmyWLho2rRKBw/1/public/values?alt=json-in-script&callback=doData"></script>
    <div id="data"/>
    <script language="javascript" src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    <script language="javascript" src="https://duojia.github.io/LIFF/liff-starter.js"></script>
</body>
