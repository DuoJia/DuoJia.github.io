<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每日一試</title>
    <link rel="stylesheet" href="https://duojia.github.io/LIFF/style.css">
</head>

<body>
    <div class="input">
        <label id="Q1" for= "Q1">Q1</label>
        <input id ='Q1_i' type="text" placeholder="your answer">
    </br>
        <label id="Q2" for= "Q2">Q2</label>
        <input id ='Q2_i' type="text" placeholder="your answer">
    </br>
        <label id="Q3" for= "Q3">Q3</label>
        <input id = 'Q3_i' type="text" placeholder="your answer">
    </br>
        <label id="Q4" for= "Q4">Q4</label>
        <input id = 'Q4_i' type="text" placeholder="your answer">
    </br>
        <label id="Q5" for= "Q5">Q5</label>
        <input id = 'Q5_i' type="text" placeholder="your answer">
    </br>
        <label id="Q6" for= "Q6">Q6</label>
        <input id = 'Q6_i' type="text" placeholder="your answer">
    </br>
        <label id="Q7" for= "Q7">Q7</label>
        <input id = 'Q7_i' type="text" placeholder="your answer">
    </br>
        <label id="Q8" for= "Q8">Q8</label>
        <input id = 'Q8_i' type="text" placeholder="your answer">
    </br>
        <label id="Q9" for= "Q9">Q9</label>
        <input id = 'Q9_i' type="text" placeholder="your answer">
    </br>
        <label id="Q10" for= "Q10">Q10</label>
        <input id = 'Q10_i' type="text" placeholder="your answer">
    </br>
        <button id="sendmessagebutton">送出答案</button>
    </div>

    <!-- Javascript 使用Papaparese 讀取QA csv -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>`
    <script src="https://cdn.staticfile.org/PapaParse/5.1.0/papaparse.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />
    <!-- script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>-->
    <!-- <script src="liff-starter.js"></script> -->
    <div id="dialog" title="Basic dialog" hidden = 'hidden'  > 
        <img src="https://duojia.github.io/LIFF/3.png" alt="Placeholder Image" />
    </div>
    </body>

    <script language="javascript">
    // 日期處理
    // var today = new Date();
    // var dd = String(today.getDate()).padStart(2, '0');
    // var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    // var yyyy = today.getFullYear();

    // today = mm + '/' + dd + '/' + yyyy;
    // document.write(today);

    var spData = null;
    function doData(json) {
        spData = json.feed.entry; //取回來的資料都會在 feed.entry 裡面
    }
    
    function readData(parent) {
      var today = new Date();
      var dd = today.getDate(); //用日期當作每天執行的參數 (dd-1)*10
      var data = spData;
      var rowData = [];
      var row = 0;
      var question = new Array();


      for(var r=(dd-1)*20; r<(dd-1)*20+20; r=r+1) { //gs$cell 一次會讀整列的東西，所以有n欄，有n欄，要讀到第二欄 必須用+1 +更多才能帶到rowData[1 2 3...n] 供寫入
          var cell = data[r]["gs$cell"];//可以透過 gs$cell 來找到所屬的欄/列
          var val = cell["$t"];
           
          console.log("r"+r)
          console.log("val:"+cell["$t"])

           if (cell.col == 1) {
                rowData = [];
                row++;
           }
           rowData.push(val);
           question[r]=rowData[0]; //rowData[0] 為每欄每列的資料
           console.log("rowData[0]:"+rowData[0]+"  rowData[1]:"+rowData[1]+"  rowData[2]:"+rowData[2])
          
      }

      //移除陣列中重複的element
      question = question.filter(function(elem, index, self) {
        return index === self.indexOf(elem);
      });

      console.log("question:"+question)

      $('#Q1').html(question[0]);
      $('#Q2').html(question[1]);
      $('#Q3').html(question[2]);
      $('#Q4').html(question[3]);
      $('#Q5').html(question[4]);
      $('#Q6').html(question[5]);
      $('#Q7').html(question[6]);
      $('#Q8').html(question[7]);
      $('#Q9').html(question[8]);
      $('#Q10').html(question[9]);

      //console.log("rowData:"+rowData[0])
      //console.log("answer:"+answer)
      //console.log("question:"+question)
    }

    function checkAns(parent) {
      var today = new Date();
      var dd = today.getDate(); //用日期當作每天執行的參數 (dd-1)*10
      var data = spData;
      var rowData = [];
      var row = 0;
      var question = new Array();
      var answer = new Array();
      var reply01 = $('#Q1_i').val(); 
      var reply02 = $('#Q2_i').val(); 
      var reply03 = $('#Q3_i').val(); 
      var reply04 = $('#Q4_i').val(); 
      var reply05 = $('#Q5_i').val(); 
      var reply06 = $('#Q6_i').val(); 
      var reply07 = $('#Q7_i').val(); 
      var reply08 = $('#Q8_i').val(); 
      var reply09 = $('#Q9_i').val(); 
      var reply10 = $('#Q10_i').val(); 
      //var reply_JS = document.getElementById("Q1_i").value;  JS抓法
      var reply = [reply01,reply02,reply03,reply04,reply05,reply06,reply07,reply08,reply09,reply10];

        //gs$cell 一次會讀整列的東西，所以有n欄，要讀到第二欄 必須用+1 +更多才能帶到rowData[1 2 3...n] 供寫入
      for(var r=(dd-1)*20; r<(dd-1)*20+20; r=r+1) {
          var cell = data[r]["gs$cell"];//可以透過 gs$cell 來找到所屬的欄/列
          var val = cell["$t"];

           if (cell.col == 1) {
                rowData = [];
                row++;
           }
           rowData.push(val);
           question[r]=rowData[0]; //值給question 
           answer[r]=rowData[1];//將每行rowData值給answer 
      }


      answer = jQuery.grep(answer, function(n){ return (n); }); //移除空的陣列
      //移除陣列中重複的element
      question = question.filter(function(elem, index, self) {
        return index === self.indexOf(elem);
      });

      var correct_number=0;
      var fault_number=0;
      for(var i=0; i<answer.length;i++){
        if(answer[i]==reply[i]){
            correct_number = correct_number+1;
        }
        else{fault_number=fault_number+1;}
      }
      
      alert("您這次答對"+correct_number+"題；答錯"+fault_number+"題"+'\n'+'答案如下：\n'+question[0]+answer[0]+'\n'+question[1]+answer[1]+'\n'+question[2]+answer[2]+'\n'+question[3]+answer[3]+'\n'+question[4]+answer[4]+'\n'
      +question[5]+answer[5]+'\n'+question[6]+answer[6]+'\n'+question[7]+answer[7]+'\n'+question[8]+answer[8]+'\n'+question[9]+answer[9]);
      console.log("answer:"+answer)
      console.log("reply:"+reply)

      //開啟dialog的參數
      var opt = {
        autoOpen: false,
        modal: true,
        resizable: false,
        width: 'auto',
        height: 'auto',
        title: '滿分集點QR code'
         };

      if (correct_number == 9|10){$(function() {$("#dialog").dialog(opt).dialog('open');});}
    }
    

    function getOs()
    {
    if(navigator.userAgent.indexOf("MSIE")>0) {
    return "IE"; //InternetExplor
    }
    else if(isFirefox=navigator.userAgent.indexOf("Firefox")>0){
    return "FF"; //firefox
    }
    else if(isSafari=navigator.userAgent.indexOf("Safari")>0) {
    return "SF"; //Safari
    }
    else if(isCamino=navigator.userAgent.indexOf("Camino")>0){
    return "C"; //Camino
    }
    else if(isMozilla=navigator.userAgent.indexOf("Gecko/")>0){
    return "G"; //Gecko
    }
    else if(isMozilla=navigator.userAgent.indexOf("Opera")>=0){
    return "O"; //opera
    }else{
    return 'Other';
    }
    }


    //頁面載入時執行
    $(document).ready(function() {
        //要執行的JQuery
        readData($("#data"));
        //PAPA Parse版本，但中文會亂碼，故改採Google sheet 方式
        // Papa.parse("https://duojia.github.io/LIFF/QA/QA1.csv", {
        //     header: true,
        //     encoding: "UTF-8",
        //     download: true,
        //     complete: function(results) {
        //         console.log(results.data[0].ans)
        //         for(var i =0;i<results.data.length;i++){
        //             question[i] = results.data[i].question
        //             answer[i] = results.data[i].ans
        //         }
        //         //修改Label值，用ID抓，來改變text值
        //         $('#Q1').html(question[0]);
        //         $('#Q2').html(question[1]);
        //         $('#Q3').html(question[2]);
        //         $('#Q4').html(question[3]);
        //         $('#Q5').html(question[4]);
        //         $('#Q6').html(question[5]);
        //         $('#Q7').html(question[6]);
        //         $('#Q8').html(question[7]);
        //         $('#Q9').html(question[8]);
        //         $('#Q10').html(question[9]);
        //     }
        // });
    });
    
    //檢查驗證答案
    $('#sendmessagebutton').on('click', function() {
            checkAns($("#data"));
            // liff.sendMessages([{
            //     'type': 'text',
            //     'text': "You've successfully sent a message! Hooray!"
            // }]).then(function() {
            //     window.alert('Message sent');
            // }).catch(function(error) {
            //     window.alert('Error sending message: ' + error);
            // });
    });

    </script>

    <script src="https://spreadsheets.google.com/feeds/cells/1sgZcl7U4iiVYCg_oOr4kYvXoyB4_NBSmyWLho2rRKBw/1/public/values?alt=json-in-script&callback=doData"></script>
    <div id="data"/>
    <script language="javascript" src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    <!-- <script language="javascript" src="https://duojia.github.io/LIFF/liff-starter.js"></script> -->
</body>
